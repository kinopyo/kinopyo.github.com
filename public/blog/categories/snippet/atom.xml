<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Snippet | Yet Another Kinopyo Blog]]></title>
  <link href="http://kinopyo.github.com/blog/categories/snippet/atom.xml" rel="self"/>
  <link href="http://kinopyo.github.com/"/>
  <updated>2012-08-26T12:20:36+09:00</updated>
  <id>http://kinopyo.github.com/</id>
  <author>
    <name><![CDATA[Qihuan Piao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[PHP プロセス数を指定して実行するマルチスレッド処理(curl_multi)]]></title>
    <link href="http://kinopyo.github.com/blog/php-multi-thread-with-specific-process-number-using-curl-multi"/>
    <updated>2011-08-09T00:00:00+09:00</updated>
    <id>http://kinopyo.github.com/blog/php-multi-thread-with-specific-process-number-using-curl-multi</id>
    <content type="html"><![CDATA[<p>curl_multi系を使って、プロセス数を指定して実行するマルチスレッド処理です。</p>

<p>urlは配列で受け取って、もし指定したプロセス数より多い場合は分割して実行するようになってます。</p>

<p>このサンプルコードではこのブログの幾つかのurlに対してtitleを取得しました。</p>

<p><em>gist id=1073555 file=multi-process-exec.php</em></p>

<p>参考：<a href="http://techblog.ecstudio.jp/tech-tips/php-multi.html">PHPでマルチスレッド(バックグラウンド処理)を実現する方法</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[githubの/usrが削除されたスレットが面白かった、Nokogiriで画像を拾うSinatra appを書いた]]></title>
    <link href="http://kinopyo.github.com/blog/a-sintra-app-to-grab-funny-images-from-a-github-thread"/>
    <updated>2011-06-21T00:00:00+09:00</updated>
    <id>http://kinopyo.github.com/blog/a-sintra-app-to-grab-funny-images-from-a-github-thread</id>
    <content type="html"><![CDATA[<h2>スレット経緯</h2>

<p>bumblebeeというgithubのプロジェクトにinstall.shというファイルがありますが、
実行するとrm -rf /usrのコマンドで/usrが全部削除されることで大騒ぎになったようです。
<a href="https://github.com/MrMEEE/bumblebee/commit/a047be85247755cdbe0acce6f1dafc8beb84f2ac">githubのスレット</a></p>

<p>{% img http://www.kinopyo.com/blog/wp-content/uploads/2011/06/bumblebee-rm-rf-usr.png bumblebee rm -rf :usr %}</p>

<p>一個スペースが多かったですね。。</p>

<p>でコメントに上がっている画像がとても面白かったので、それをNokogiriを使って拾うrubyコードを書きました。プログラマのヒューモア満載の画像ですね。</p>

<p>Sinatra + Nokogiri + Herokuで作りました、キャッシュは<a href="https://github.com/mperham/dalli">dalli</a>というgemを使いました。</p>

<h2>成果</h2>

<p>下記iframeで表示しています。urlは<a href="http://kinopyo-omgmyusr.heroku.com">http://kinopyo-omgmyusr.heroku.com</a></p>

<iframe src="http://kinopyo-omgmyusr.heroku.com/" scrolling="yes" width="480" height="720" >
</iframe>


<h2>ソースコード</h2>

<p>githubに上げています。
<a href="https://github.com/kinopyo/Funny-Images-in-bumblebee-rm--rf--usr-thread">https://github.com/kinopyo/Funny-Images-in-bumblebee-rm--rf--usr-thread</a></p>

<p>参考になったリンク：
<a href="http://devcenter.heroku.com/articles/memcache">http://devcenter.heroku.com/articles/memcache</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[PHPで他のJSON形式APIをコールするサンプルコード]]></title>
    <link href="http://kinopyo.github.com/blog/php-call-json-api-sample-code"/>
    <updated>2011-03-07T00:00:00+09:00</updated>
    <id>http://kinopyo.github.com/blog/php-call-json-api-sample-code</id>
    <content type="html"><![CDATA[<p>file_get_contentsとjson_decodeの組み合わせでAPIコールするサンプルコードです。</p>

<p>```php
// APIコール
$api_url = 'http://example.com/api/';
$api_ret = file_get_contents($api_url);</p>

<p>// JSONにデコード
$api_result = json_decode($api_ret,true);</p>

<p>// APIエラーチェック: 何かしらの成功フラグでチェック
if(isset($api_result<em>'success']) &amp;&amp; $api_result['success'</em> == 0)
{</p>

<pre><code>// 処理
</code></pre>

<p>}
else
{</p>

<pre><code>// handle error
</code></pre>

<p>}</p>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Spring DataSource beanのメモ]]></title>
    <link href="http://kinopyo.github.com/blog/how-to-define-spring-datasource-bean"/>
    <updated>2010-12-06T00:00:00+09:00</updated>
    <id>http://kinopyo.github.com/blog/how-to-define-spring-datasource-bean</id>
    <content type="html"><![CDATA[<p>DataSource Beanを定義する際applicationContext.xmlの書き方と、Javaで呼び出すコードのメモです。ずいぶん昔のメモです。。</p>

<p>こんなjdbc.propertiesファイルがクラスパスにあるとします。</p>

<p>```
jdbc.driverClassName=org.h2.Driver
jdbc.url=jdbc:h2:~/test
jdbc.username=sa
jdbc.password=</p>

<p>```</p>

<p>そしてSpringのapplicationContext.xmlにはこう書きます。</p>

<p>```xml
&lt;context:property-placeholder location="jdbc.properties"/></p>

<p>&lt;bean id="dataSource"</p>

<pre><code>class="org.springframework.jdbc.datasource.DriverManagerDataSource"&gt;
&lt;property name="driverClassName" value="${jdbc.driverClassName}" /&gt;
&lt;property name="url" value="${jdbc.url}" /&gt;
&lt;property name="username" value="${jdbc.username}" /&gt;
&lt;property name="password" value="${jdbc.password}" /&gt;
</code></pre>

<p></bean></p>

<p><bean id="accountDao" class="test.dao.AccountDao"></p>

<pre><code>&lt;property name="dataSource" ref="dataSource" /&gt;
</code></pre>

<p></bean></p>

<p>```</p>

<p>Javaでの呼び出し：</p>

<p>```java
ApplicationContext context = new ClassPathXmlApplicationContext(</p>

<pre><code>    "applicationContext.xml");
</code></pre>

<p>AccountDao accountDao = (AccountDao) context.getBean("accountDao");</p>

<p>// other code...</p>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[JavaScript: カンマ区切りで数値をフォーマットする]]></title>
    <link href="http://kinopyo.github.com/blog/javascript-format-number-to-japanese-currency"/>
    <updated>2010-11-29T00:00:00+09:00</updated>
    <id>http://kinopyo.github.com/blog/javascript-format-number-to-japanese-currency</id>
    <content type="html"><![CDATA[<p>```javascript</p>

<p>/##
 #  数値を日本円表現にフォーマット。
 #  例：12345 -> 12,345
 #
 # /
num2Currency = function(obj){</p>

<pre><code>// 画面項目の値
var str=obj.value;
var num = new String(str).replace(/,/g/"");
while(num != (num =num.replace(/^(-?\d+)(\d{3})/,"$1,$2")));
obj.value = num;
</code></pre>

<p>}</p>

<p>/##
 #  日本円表現を数値にフォーマット。
 #  例：123,45 -> 12345
 #
 # /
currency2Num = function(obj){</p>

<pre><code>var str=obj.value;
var num = str.replace(/,/g,"");
obj.value = num;
</code></pre>

<p>}</p>

<p>```</p>
]]></content>
  </entry>
  
</feed>
