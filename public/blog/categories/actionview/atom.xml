<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: ActionView | Yet Another Kinopyo Blog]]></title>
  <link href="http://kinopyo.com/blog/categories/actionview/atom.xml" rel="self"/>
  <link href="http://kinopyo.com/"/>
  <updated>2012-09-29T01:26:08+09:00</updated>
  <id>http://kinopyo.com/</id>
  <author>
    <name><![CDATA[Qihuan Piao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails オプション(省略可)local variablesをpartial viewに渡す方法]]></title>
    <link href="http://kinopyo.com/blog/rails-passing-optional-local-variables-to-partial-view"/>
    <updated>2011-11-07T00:00:00+09:00</updated>
    <id>http://kinopyo.com/blog/rails-passing-optional-local-variables-to-partial-view</id>
    <content type="html"><![CDATA[<p>例えば省略可能なフラグみたいなローカル変数をpartial viewに渡した時、そのデフォルト動作をpartial viewでハンドリングしたいですね。
<div><script src='https://gist.github.com/1344066.js?file=use_case_sample.erb'></script>
<noscript><pre><code>&lt;%= render 'article', :show_author =&gt; false %&gt;
&lt;%= render 'article' %&gt;
</code></pre></noscript></div>
</p>

<p>調べてみたら<em>defined?</em>と<em>local_assigns.has_key?</em>が見つかりましたが、前者のほうはオススメできなさそうです。
<blockquote><p>Testing using defined? headline will not work. This is an implementation restriction.</p><footer><strong>ActionView::Base</strong> <cite><a href='http://api.rubyonrails.org/classes/ActionView/Base.html'>api.rubyonrails.org/classes/&hellip;</a></cite></footer></blockquote></p>

<p><div><script src='https://gist.github.com/1344066.js?file=solution.erb'></script>
<noscript><pre><code># http://api.rubyonrails.org/classes/ActionView/Base.html

# If you need to find out whether a certain local variable
# has been assigned a value in a particular render call, 
# you need to use the following pattern:

&lt;% unless local_assigns.has_key? :show_author %&gt;
  &lt;% show_author = true %&gt;
&lt;% end %&gt;

&lt;% if show_author %&gt;
  Author: &lt;%= @article.author %&gt;
&lt;% end %&gt;

# Testing using defined? headline will not work. This is an implementation restriction.
</code></pre></noscript></div>

実際やってみて、defined?でも動けるパターンはありますが、if/unless文で一行にしたらバグりました。なのでやはり<em> local_assigns.has_key?</em>を使いましょう。</p>

<p><div><script src='https://gist.github.com/1344066.js?file=compared_to_defined_method_with_oneline_condition.erb'></script>
<noscript><pre><code># this will work
&lt;% unless defined?(:show_author) %&gt;
  &lt;% show_author = true %&gt;
&lt;% end %&gt;

# NOT work
&lt;% show_author = true unless defined?(:show_author) %&gt;

# this will work
&lt;% show_author = true unless local_assigns.has_key? :show_author %&gt;</code></pre></noscript></div>
</p>

<h2>Resources</h2>

<p><a href="http://stackoverflow.com/questions/238615/defined-method-in-ruby-and-rails">http://stackoverflow.com/questions/238615/defined-method-in-ruby-and-rails</a>
<a href="http://api.rubyonrails.org/classes/ActionView/Base.html">http://api.rubyonrails.org/classes/ActionView/Base.html</a></p>
]]></content>
  </entry>
  
</feed>
