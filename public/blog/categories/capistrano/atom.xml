<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Capistrano | Yet Another Kinopyo Blog]]></title>
  <link href="http://kinopyo.github.com/blog/categories/capistrano/atom.xml" rel="self"/>
  <link href="http://kinopyo.github.com/"/>
  <updated>2012-08-29T01:53:12+09:00</updated>
  <id>http://kinopyo.github.com/</id>
  <author>
    <name><![CDATA[Qihuan Piao]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Rails3.1 Capistranoでデプロイする時にpublic/images, stylesheets, javascriptsのNo such file or directoryエラー]]></title>
    <link href="http://kinopyo.github.com/blog/rails31-got-no-such-file-or-directoryerror-when-deploy-with-capistrano-public-images-stylesheets-javascripts"/>
    <updated>2011-09-25T00:00:00+09:00</updated>
    <id>http://kinopyo.github.com/blog/rails31-got-no-such-file-or-directoryerror-when-deploy-with-capistrano-public-images-stylesheets-javascripts</id>
    <content type="html"><![CDATA[<p>自分のログは無くしたので@yuum3のログを引用させて頂きます。
<blockquote><p>#  executing "find /home/rails_apps/todo31/releases/20110912141706/public/images /home/rails_apps/todo31/releases/20110912141706/public/stylesheets /home/rails_apps/todo31/releases/20110912141706/public/javascripts -exec touch -t 201109121417.06 {} ';'; true"</p></p><p><pre><code>servers: *"176.32.95.168"*<br/>*176.32.95.168* executing command<br/></code></pre></p><p><h3><em>err :: 176.32.95.168</em> find:</h3></p><p><h3><em>err :: 176.32.95.168</em> `/home/rails_apps/todo31/releases/20110912141706/public/images'</h3></p><p><h3><em>err :: 176.32.95.168</em> : No such file or directory</h3></p><p><h3><em>err :: 176.32.95.168</em></h3></p><p><h3><em>err :: 176.32.95.168</em> find:</h3></p><p><h3><em>err :: 176.32.95.168</em> `/home/rails_apps/todo31/releases/20110912141706/public/stylesheets'</h3></p><p><h3><em>err :: 176.32.95.168</em> : No such file or directory</h3></p><p><h3><em>err :: 176.32.95.168</em></h3></p><p><h3><em>err :: 176.32.95.168</em> find:</h3></p><p><h3><em>err :: 176.32.95.168</em> `/home/rails_apps/todo31/releases/20110912141706/public/javascripts'</h3></p><p><h3><em>err :: 176.32.95.168</em> : No such file or directory</h3></p><p><h3><em>err :: 176.32.95.168</em></h3></p><p><p></p></blockquote></p>

<p><a href="https://github.com/capistrano/capistrano/issues/79#issuecomment-1767135" title="Githubにも載ってました。" target="_blank">Githubにも載ってました</a>エラーは無視しても大丈夫そうですが、下記の一行をdeploy.rbに追記すればエラー出なくなります。</p>

<p>```ruby</p>

<h1>in config/deploy.rb</h1>

<p>set :normalize_asset_timestamps, false</p>

<p>```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rails3.1 Production環境で画像が表示されない、HTTP Statusは200成功なのに]]></title>
    <link href="http://kinopyo.github.com/blog/rails31-image-do-not-show-in-production-while-http-status-code-is-200"/>
    <updated>2011-09-24T00:00:00+09:00</updated>
    <id>http://kinopyo.github.com/blog/rails31-image-do-not-show-in-production-while-http-status-code-is-200</id>
    <content type="html"><![CDATA[<h2>現象</h2>

<p>Railsを-e productionで立ち上がるとき、或いはcapistrano本番サーバにデプロイしてアクセスする時に、HTTPのStatusは200なのに画像などが表示されない。JavascriptとCSSは問題ない。
発生バージョンはRails 3.1。</p>

<h2>解決策</h2>

<p>app/tmp/cacheを削除し、rake assets:precompileをもう一回実行。
ブラウザキャッシュを消してリロード。</p>

<h2>調査経緯</h2>

<p>assets周りの設定やfingerprint(MD5のハッシュ値)の比較など全部チェックしましたが、全然ダメでした。
最後はgithubの<a href="https://gist.github.com/rails/rails/issues/2299" title="このスレ" target="_blank">このスレ</a>の方法で解決になりました。</p>

<p>問題となったrails applicationはRails 3.1.rc1から作っていたもので、そのままrc4, rc5, stableに更新してきました。githubで議論されたのはrc4からrc5になったときにこのような現象があったようです。恐らくtmp/cacheが変な動きをして手動で削除しない限り古いバージョンのものがずっと残されたかもしれません。</p>

<h2>おまけ</h2>

<p>Asset Pipelineの周りの設定ファイルを一応貼っておきます。</p>

<p><div><script src='https://gist.github.com/1239153.js?file='></script>
<noscript><pre><code># Disable Rails's static asset server (Apache or nginx will already do this)
config.serve_static_assets = false

# Compress JavaScripts and CSS
config.assets.compress = true

# Don't fallback to assets pipeline if a precompiled asset is missed
config.assets.compile = false

# Generate digests for assets URLs
config.assets.digest = true

# Specifies the header that your server uses for sending files
# config.action_dispatch.x_sendfile_header = &quot;X-Sendfile&quot; # for apache
# config.action_dispatch.x_sendfile_header = 'X-Accel-Redirect' # for nginx
</code></pre></noscript></div>
</p>

<p>Githubでのスレ：<a href="https://gist.github.com/rails/rails/issues/2299">https://gist.github.com/rails/rails/issues/2299</a></p>
]]></content>
  </entry>
  
</feed>
